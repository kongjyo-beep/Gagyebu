<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì•„ì´í° ê°€ê³„ë¶€ Pro Max</title>
<style>
    :root {
        --ios-bg: #F2F2F7;
        --ios-card: #FFFFFF;
        --ios-blue: #007AFF;
        --ios-red: #FF3B30;
        --ios-green: #34C759;
        --ios-yellow: #FFCC00;
        --ios-gray-text: #8E8E93;
        --ios-border: #E5E5EA;
        --ios-black: #000000;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--ios-bg);
        margin: 0;
        padding: 0;
        color: var(--ios-black);
        -webkit-font-smoothing: antialiased;
        user-select: none; 
        padding-bottom: 50px;
    }

    /* --- ìƒë‹¨ ëŒ€ì‹œë³´ë“œ --- */
    .header-card {
        background: var(--ios-card);
        padding: 20px;
        border-bottom-left-radius: 24px;
        border-bottom-right-radius: 24px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.06);
        margin-bottom: 20px;
    }

    .main-balance { text-align: center; margin-bottom: 25px; }
    .header-label { font-size: 14px; color: var(--ios-gray-text); margin-bottom: 6px; }
    .balance-amount { font-size: 38px; font-weight: 700; letter-spacing: -0.5px; }

    /* ì„œë¸Œ ì •ë³´ ê·¸ë¦¬ë“œ */
    .sub-info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 25px;
    }
    
    .info-box {
        background: #F9F9F9;
        border-radius: 18px;
        padding: 15px;
        text-align: center;
        box-shadow: inset 0 0 0 1px rgba(0,0,0,0.03);
    }
    .info-title { font-size: 12px; color: #888; margin-bottom: 6px; font-weight: 500; }
    .info-value { font-size: 17px; font-weight: 700; }
    
    .val-saving { color: var(--ios-blue); }
    .val-good { color: var(--ios-green); }
    .val-bad { color: var(--ios-red); }

    /* ë²„íŠ¼ ê·¸ë£¹ */
    .action-row { display: flex; gap: 10px; }
    .btn-main {
        flex: 1; padding: 14px; border-radius: 14px; border: none;
        font-size: 15px; font-weight: 600; color: white;
        background: var(--ios-blue); cursor: pointer; transition: opacity 0.2s;
        box-shadow: 0 2px 6px rgba(0,122,255,0.2);
    }
    .btn-main:active { opacity: 0.7; transform: scale(0.98); }
    .btn-income { background: var(--ios-green); box-shadow: 0 2px 6px rgba(52,199,89,0.2); }
    .btn-budget { background: white; color: var(--ios-blue); border: 1px solid var(--ios-blue); box-shadow: none; }

    /* --- ê³µí†µ ëª¨ë‹¬/í¼ --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.4);
        display: none; z-index: 1000;
        align-items: center; justify-content: center;
        backdrop-filter: blur(2px);
    }
    .modal-overlay.active { display: flex; }

    .input-group, .budget-modal {
        background: white; width: 85%; max-width: 360px;
        padding: 24px; border-radius: 24px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        animation: popUp 0.25s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes popUp { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .form-row { margin-bottom: 16px; }
    .form-label { font-size: 13px; font-weight:600; color: #333; margin-bottom: 6px; display: block; }
    input, select {
        width: 100%; box-sizing: border-box; padding: 14px;
        border-radius: 12px; border: 1px solid #E5E5EA;
        font-size: 16px; background: #F2F2F7; -webkit-appearance: none;
    }
    input:focus, select:focus { background: white; border-color: var(--ios-blue); outline: none; }

    /* --- ë‹¬ë ¥ --- */
    .calendar-container {
        background: var(--ios-card); margin: 0 16px; border-radius: 20px;
        padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    }
    .cal-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .cal-title { font-size: 18px; font-weight: 700; }
    .nav-btn { background: none; border: none; font-size: 16px; color: var(--ios-blue); padding: 5px; cursor: pointer;}
    .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 12px; color: #999; margin-bottom: 10px; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
    
    .day-cell {
        height: 54px; display: flex; flex-direction: column; align-items: center;
        cursor: pointer; border-radius: 10px; position: relative; padding-top:6px;
    }
    .day-cell.today { background: rgba(0,122,255,0.08); }
    .day-cell.selected { border: 2px solid var(--ios-blue); }
    
    .day-num { font-size: 15px; font-weight: 500; margin-bottom: 4px; }
    .status-dot { width: 5px; height: 5px; border-radius: 50%; }
    .dot-green { background-color: var(--ios-green); }
    .dot-yellow { background-color: var(--ios-yellow); }
    .dot-red { background-color: var(--ios-red); }
    
    .sun { color: var(--ios-red); } .sat { color: var(--ios-blue); }

    /* --- ë¦¬ìŠ¤íŠ¸ --- */
    .detail-section { margin: 24px 16px; }
    .list-header { font-size: 18px; font-weight:700; margin-bottom: 10px; margin-left: 5px; }
    .record-list { background: var(--ios-card); border-radius: 16px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
    .record-item {
        padding: 18px; border-bottom: 1px solid var(--ios-border);
        display: flex; justify-content: space-between; align-items: center;
    }
    .record-item:active { background: #f5f5f5; }
    .record-cat { font-size: 16px; font-weight: 500; margin-bottom: 2px;}
    .record-sub { font-size: 12px; color: #999; }
    .amount-expense { color: var(--ios-black); font-weight:600; font-size: 16px; }
    .amount-income { color: var(--ios-green); font-weight:600; font-size: 16px; }
    .amount-saving { color: var(--ios-blue); font-weight:600; font-size: 16px; }

    /* --- ì•¡ì…˜ ì‹œíŠ¸ (ì‚­ì œ/ìˆ˜ì • ë©”ë‰´) --- */
    .action-sheet-overlay {
        position: fixed; top:0; left:0; right:0; bottom:0;
        background: rgba(0,0,0,0.5); z-index: 2000;
        display: none; align-items: flex-end;
    }
    .action-sheet-overlay.active { display: flex; }
    .action-sheet {
        background: transparent; width: 100%; padding: 10px;
        box-sizing: border-box;
        animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    
    .sheet-btn {
        background: white; border: none; width: 100%; padding: 18px;
        font-size: 17px; color: var(--ios-blue); margin-bottom: 1px; cursor: pointer;
    }
    .sheet-btn:first-child { border-top-left-radius: 14px; border-top-right-radius: 14px; }
    .sheet-btn:last-child { border-bottom-left-radius: 14px; border-bottom-right-radius: 14px; margin-bottom: 8px; }
    .sheet-cancel { border-radius: 14px; font-weight: 600; background: white; }
    .sheet-delete { color: var(--ios-red); }
    .hidden { display: none; }
    
</style>
</head>
<body>

<div class="header-card">
    <div class="main-balance">
        <div class="header-label">í˜„ì¬ ì”ê³ </div>
        <div class="balance-amount" id="balanceDisplay">0ì›</div>
    </div>

    <div class="sub-info-grid">
        <div class="info-box">
            <div class="info-title">ğŸ’° ì €ì¶• í†µì¥</div>
            <div class="info-value val-saving" id="savingsDisplay">0ì›</div>
        </div>
        <div class="info-box">
            <div class="info-title">ğŸ‘ ì´ë²ˆ ë‹¬ ì•„ë‚€ ëˆ</div>
            <div class="info-value" id="accumulatedSaveDisplay">0ì›</div>
        </div>
    </div>

    <div class="action-row">
        <button class="btn-main" onclick="openForm('expense')">ì§€ì¶œ ê¸°ë¡</button>
        <button class="btn-main btn-income" onclick="openForm('income')">ìˆ˜ì… ê¸°ë¡</button>
        <button class="btn-main btn-budget" onclick="openBudgetModal()">ì˜ˆì‚° ì„¤ì •</button>
    </div>
</div>

<div class="modal-overlay" id="formOverlay" onclick="closeForm(event)">
    <div class="input-group" id="inputForm">
        <h3 id="formTitle" style="margin:0 0 20px 0;">ë‚´ì—­ ì¶”ê°€</h3>
        
        <div class="form-row">
            <label class="form-label">ë‚ ì§œ</label>
            <input type="date" id="inputDate">
        </div>

        <div class="form-row">
            <label class="form-label">ìœ í˜•</label>
            <select id="inputType" onchange="handleTypeChange()">
                <option value="expense">ì§€ì¶œ</option>
                <option value="saving">ì €ì¶•</option>
                <option value="income">ìˆ˜ì…</option>
            </select>
        </div>

        <div class="form-row" id="categoryRow">
            <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
            <select id="inputCategory" onchange="handleCategoryChange()">
                <option value="ì‹ë¹„">ì‹ë¹„</option>
                <option value="êµí†µ">êµí†µ</option>
                <option value="ì‡¼í•‘">ì‡¼í•‘</option>
                <option value="ì£¼ê±°">ì£¼ê±°/í†µì‹ </option>
                <option value="ì˜ë£Œ">ì˜ë£Œ/ê±´ê°•</option>
                <option value="ë¬¸í™”">ë¬¸í™”/ì—¬ê°€</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€ (ì§ì ‘ì…ë ¥)</option>
            </select>
            <input type="text" id="customCategory" class="hidden" placeholder="ì¹´í…Œê³ ë¦¬ëª… ì…ë ¥" style="margin-top:8px;">
        </div>

        <div class="form-row">
            <label class="form-label">ê¸ˆì•¡</label>
            <input type="number" id="inputAmount" placeholder="0" inputmode="numeric">
        </div>

        <button class="btn-main" style="width:100%" onclick="saveRecord()">ì €ì¥í•˜ê¸°</button>
    </div>
</div>

<div class="modal-overlay" id="budgetOverlay" onclick="closeBudgetModal(event)">
    <div class="budget-modal">
        <h3 style="margin:0 0 10px 0;">ìš”ì¼ë³„ ì˜ˆì‚°</h3>
        <p style="font-size:13px; color:#888; margin-bottom:20px;">ì¼ìš”ì¼ë¶€í„° í† ìš”ì¼ê¹Œì§€ í•˜ë£¨ ì˜ˆì‚°ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
            <div><label class="form-label" style="color:red">ì¼ìš”ì¼</label><input type="number" id="bg_0"></div>
            <div><label class="form-label">ì›”ìš”ì¼</label><input type="number" id="bg_1"></div>
            <div><label class="form-label">í™”ìš”ì¼</label><input type="number" id="bg_2"></div>
            <div><label class="form-label">ìˆ˜ìš”ì¼</label><input type="number" id="bg_3"></div>
            <div><label class="form-label">ëª©ìš”ì¼</label><input type="number" id="bg_4"></div>
            <div><label class="form-label">ê¸ˆìš”ì¼</label><input type="number" id="bg_5"></div>
            <div><label class="form-label" style="color:blue">í† ìš”ì¼</label><input type="number" id="bg_6"></div>
        </div>
        <button class="btn-main" style="width:100%; margin-top:20px;" onclick="saveBudgets()">ì €ì¥</button>
    </div>
</div>

<div class="action-sheet-overlay" id="actionSheet" onclick="closeActionSheet(event)">
    <div class="action-sheet">
        <div style="border-radius:14px; overflow:hidden; margin-bottom:8px;">
            <button class="sheet-btn" onclick="executeEdit()">ìˆ˜ì •í•˜ê¸°</button>
            <div style="height:1px; background:#E5E5EA;"></div>
            <button class="sheet-btn sheet-delete" onclick="executeDelete()">ì‚­ì œí•˜ê¸°</button>
        </div>
        <button class="sheet-btn sheet-cancel" onclick="closeActionSheetReal()">ì·¨ì†Œ</button>
    </div>
</div>

<div class="calendar-container">
    <div class="cal-nav">
        <button class="nav-btn" onclick="changeMonth(-1)">â—€ ì´ì „</button>
        <div class="cal-title" id="monthTitle"></div>
        <button class="nav-btn" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
    </div>
    <div class="weekdays">
        <div class="sun">ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div class="sat">í† </div>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
</div>

<div class="detail-section">
    <div class="list-header" id="selectedDateTitle">ì˜¤ëŠ˜ì˜ ë‚´ì—­</div>
    <p style="font-size:13px; color:#aaa; margin-left:5px; margin-top:0;">ğŸ’¡ í•­ëª©ì„ ê¸¸ê²Œ ëˆ„ë¥´ë©´ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥</p>
    <div class="record-list" id="recordList"></div>
</div>

<script>
    // --- ë°ì´í„° ë¡œë“œ ---
    let balance = parseInt(localStorage.getItem("balance")) || 0;
    let savings = parseInt(localStorage.getItem("savings")) || 0; 
    let records = JSON.parse(localStorage.getItem("records")) || {};
    let budgets = JSON.parse(localStorage.getItem("dailyBudgets")) || [50000, 30000, 30000, 30000, 30000, 30000, 50000];
    
    let currentDate = new Date();
    let selectedDate = new Date();
    
    // ìˆ˜ì •/ì‚­ì œ ì„ì‹œ ë³€ìˆ˜
    let targetKey = null;
    let targetIndex = null;
    let isEditing = false;

    // ì´ˆê¸° ì‹¤í–‰
    document.addEventListener("DOMContentLoaded", () => {
        updateDashboard();
        renderCalendar();
        showRecordsForDate(new Date());
    });

    // --- ìœ í‹¸ë¦¬í‹° ---
    function formatMoney(num) { return num.toLocaleString(); }
    function getDateKey(dateObj) {
        const offset = dateObj.getTimezoneOffset() * 60000;
        return (new Date(dateObj - offset)).toISOString().slice(0, 10);
    }
    
    function saveData() {
        localStorage.setItem("balance", balance);
        localStorage.setItem("savings", savings);
        localStorage.setItem("records", JSON.stringify(records));
        localStorage.setItem("dailyBudgets", JSON.stringify(budgets));
        updateDashboard();
        renderCalendar();
    }

    // --- í•µì‹¬ ë¡œì§: ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ---
    function updateDashboard() {
        document.getElementById("balanceDisplay").innerText = formatMoney(balance) + "ì›";
        document.getElementById("savingsDisplay").innerText = formatMoney(savings) + "ì›";
        
        // **ëˆ„ì  ì•„ë‚€ ëˆ ê³„ì‚° (1ì¼ ~ ì˜¤ëŠ˜)**
        let today = new Date();
        let currentYear = today.getFullYear();
        let currentMonth = today.getMonth();
        let todayDate = today.getDate();
        
        let accumulatedSaved = 0;

        for(let d=1; d<=todayDate; d++){
            let dateObj = new Date(currentYear, currentMonth, d);
            let key = getDateKey(dateObj);
            let dayOfWeek = dateObj.getDay(); // 0~6
            let dailyBudget = budgets[dayOfWeek];
            
            // í•´ë‹¹ ë‚ ì§œì˜ 'ì§€ì¶œ(expense)'ë§Œ í•©ì‚° (ì €ì¶•,ìˆ˜ì… ì œì™¸)
            let dailyExpense = 0;
            if(records[key]){
                records[key].forEach(r => {
                    if(r.type === 'expense') dailyExpense += r.amount;
                });
            }
            
            // ì˜ˆì‚° - ì§€ì¶œ = ì•„ë‚€ ëˆ (ë§ˆì´ë„ˆìŠ¤ë©´ ì˜¤ë²„í•œ ëˆ)
            // ì´ê²ƒì„ ëˆ„ì í•´ì„œ ë”í•¨
            accumulatedSaved += (dailyBudget - dailyExpense);
        }

        let saveEl = document.getElementById("accumulatedSaveDisplay");
        if(accumulatedSaved >= 0) {
            saveEl.innerText = "+" + formatMoney(accumulatedSaved) + "ì›";
            saveEl.className = "info-value val-good";
        } else {
            saveEl.innerText = formatMoney(accumulatedSaved) + "ì›";
            saveEl.className = "info-value val-bad";
        }
    }

    // --- í¼ ê´€ë¦¬ ---
    function openForm(mode, record=null) {
        document.getElementById("formOverlay").classList.add("active");
        const typeSelect = document.getElementById("inputType");
        const catRow = document.getElementById("categoryRow");

        if(record) { // ìˆ˜ì • ëª¨ë“œ
            document.getElementById("formTitle").innerText = "ë‚´ì—­ ìˆ˜ì •";
            document.getElementById("inputDate").value = targetKey;
            document.getElementById("inputAmount").value = record.amount;
            
            typeSelect.innerHTML = `<option value="expense">ì§€ì¶œ</option><option value="saving">ì €ì¶•</option><option value="income">ìˆ˜ì…</option>`;
            typeSelect.value = record.type;

            if(record.type === 'expense') {
                catRow.classList.remove("hidden");
                const basic = ["ì‹ë¹„","êµí†µ","ì‡¼í•‘","ì£¼ê±°","ì˜ë£Œ","ë¬¸í™”"];
                if(basic.includes(record.category)){
                    document.getElementById("inputCategory").value = record.category;
                    document.getElementById("customCategory").classList.add("hidden");
                } else {
                    document.getElementById("inputCategory").value = "ê¸°íƒ€";
                    document.getElementById("customCategory").classList.remove("hidden");
                    document.getElementById("customCategory").value = record.category;
                }
            } else {
                catRow.classList.add("hidden");
            }
        } else { // ì‹ ê·œ ëª¨ë“œ
            isEditing = false;
            document.getElementById("formTitle").innerText = "ë‚´ì—­ ì¶”ê°€";
            document.getElementById("inputDate").valueAsDate = selectedDate;
            document.getElementById("inputAmount").value = "";
            document.getElementById("customCategory").value = "";
            
            typeSelect.innerHTML = "";
            if(mode === 'expense') {
                typeSelect.add(new Option("ì§€ì¶œ", "expense"));
                typeSelect.add(new Option("ì €ì¶•", "saving"));
                catRow.classList.remove("hidden");
            } else {
                typeSelect.add(new Option("ìˆ˜ì…", "income"));
                catRow.classList.add("hidden");
            }
        }
    }

    function handleTypeChange() {
        let type = document.getElementById("inputType").value;
        let catRow = document.getElementById("categoryRow");
        if(type === 'expense') catRow.classList.remove("hidden");
        else catRow.classList.add("hidden");
    }

    function handleCategoryChange() {
        if(document.getElementById("inputCategory").value === "ê¸°íƒ€") {
            document.getElementById("customCategory").classList.remove("hidden");
        } else {
            document.getElementById("customCategory").classList.add("hidden");
        }
    }

    function closeForm(e) { if(e.target.id==="formOverlay") document.getElementById("formOverlay").classList.remove("active"); }
    function closeFormReal() { document.getElementById("formOverlay").classList.remove("active"); }

    function saveRecord() {
        let dateVal = document.getElementById("inputDate").value;
        let type = document.getElementById("inputType").value;
        let amount = parseInt(document.getElementById("inputAmount").value);
        let category = "-";

        if(!dateVal || isNaN(amount)) { alert("ë‚ ì§œì™€ ê¸ˆì•¡ì„ í™•ì¸í•˜ì„¸ìš”."); return; }

        if(type === 'expense') {
            let catSelect = document.getElementById("inputCategory").value;
            category = (catSelect === 'ê¸°íƒ€') ? (document.getElementById("customCategory").value || 'ê¸°íƒ€') : catSelect;
        } else if(type === 'saving') {
            category = "ì €ì¶•";
        } else {
            category = "ìˆ˜ì…";
        }

        // ìˆ˜ì • ì‹œ: ë¡¤ë°± ì²˜ë¦¬
        if(isEditing) {
            let oldR = records[targetKey][targetIndex];
            if(oldR.type === 'income') balance -= oldR.amount;
            else if(oldR.type === 'saving') { balance += oldR.amount; savings -= oldR.amount; }
            else balance += oldR.amount; 
            
            records[targetKey].splice(targetIndex, 1);
            if(records[targetKey].length === 0) delete records[targetKey];
        }

        // ì €ì¥
        if(!records[dateVal]) records[dateVal] = [];
        records[dateVal].push({ type, amount, category });

        // ì¬ì • ë°˜ì˜
        if(type === 'income') balance += amount;
        else if(type === 'saving') { balance -= amount; savings += amount; }
        else balance -= amount; 

        saveData();
        closeFormReal();
        
        selectedDate = new Date(dateVal);
        renderCalendar(); 
        showRecordsForDate(selectedDate);
    }

    // --- ì•¡ì…˜ ì‹œíŠ¸ ---
    function openActionSheet(key, index, record) {
        targetKey = key;
        targetIndex = index;
        document.getElementById("actionSheet").classList.add("active");
    }
    function closeActionSheet(e) { if(e.target.id === "actionSheet") closeActionSheetReal(); }
    function closeActionSheetReal() { document.getElementById("actionSheet").classList.remove("active"); }

    function executeEdit() {
        closeActionSheetReal();
        isEditing = true;
        let record = records[targetKey][targetIndex];
        openForm(null, record);
    }

    function executeDelete() {
        if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì”ê³ ë„ ë³µêµ¬ë©ë‹ˆë‹¤.")) return;
        
        let record = records[targetKey][targetIndex];
        
        if(record.type === 'income') balance -= record.amount;
        else if(record.type === 'saving') { balance += record.amount; savings -= record.amount; }
        else balance += record.amount;

        records[targetKey].splice(targetIndex, 1);
        if(records[targetKey].length === 0) delete records[targetKey];

        saveData();
        closeActionSheetReal();
        showRecordsForDate(new Date(targetKey));
    }

    // --- ì˜ˆì‚° ì„¤ì • ---
    function openBudgetModal() {
        document.getElementById("budgetOverlay").classList.add("active");
        for(let i=0; i<7; i++) document.getElementById(`bg_${i}`).value = budgets[i];
    }
    function closeBudgetModal(e) { if(e.target.id==="budgetOverlay") document.getElementById("budgetOverlay").classList.remove("active"); }
    function saveBudgets() {
        for(let i=0; i<7; i++) budgets[i] = parseInt(document.getElementById(`bg_${i}`).value) || 0;
        saveData();
        document.getElementById("budgetOverlay").classList.remove("active");
    }

    // --- ë‹¬ë ¥ UI ---
    function renderCalendar() {
        let year = currentDate.getFullYear();
        let month = currentDate.getMonth();
        document.getElementById("monthTitle").innerText = `${year}ë…„ ${month+1}ì›”`;
        
        let grid = document.getElementById("calendarGrid");
        grid.innerHTML = "";
        
        let firstDay = new Date(year, month, 1).getDay();
        let lastDate = new Date(year, month+1, 0).getDate();

        for(let i=0; i<firstDay; i++) grid.appendChild(document.createElement("div"));

        for(let d=1; d<=lastDate; d++){
            let dateObj = new Date(year, month, d);
            let key = getDateKey(dateObj);
            let dayOfWeek = dateObj.getDay();
            
            let el = document.createElement("div");
            el.className = "day-cell";
            
            let todayKey = getDateKey(new Date());
            if(key === todayKey) el.classList.add("today");
            if(key === getDateKey(selectedDate)) el.classList.add("selected");
            
            el.innerHTML = `<div class="day-num" style="color:${dayOfWeek===0?'var(--ios-red)':(dayOfWeek===6?'var(--ios-blue)':'black')}">${d}</div>`;
            
            let dailyExp = 0;
            if(records[key]) records[key].forEach(r => { if(r.type==='expense') dailyExp+=r.amount; });
            
            // ì (Dot) ì°ê¸° ë¡œì§
            if(dailyExp > 0) {
                let limit = budgets[dayOfWeek];
                let dot = document.createElement("div");
                dot.className = "status-dot";
                if(dailyExp > limit) dot.classList.add("dot-red");
                else if(dailyExp === limit) dot.classList.add("dot-yellow");
                else dot.classList.add("dot-green");
                el.appendChild(dot);
            }
            
            el.onclick = () => {
                selectedDate = new Date(year, month, d);
                renderCalendar();
                showRecordsForDate(selectedDate);
            };
            grid.appendChild(el);
        }
    }

    function changeMonth(n) { currentDate.setMonth(currentDate.getMonth()+n); renderCalendar(); }

    function showRecordsForDate(dateObj) {
        let key = getDateKey(dateObj);
        document.getElementById("selectedDateTitle").innerText = `${dateObj.getMonth()+1}ì›” ${dateObj.getDate()}ì¼ ë‚´ì—­`;
        let list = document.getElementById("recordList");
        list.innerHTML = "";
        
        let dayRecords = records[key] || [];
        if(dayRecords.length === 0) {
            list.innerHTML = `<div style="padding:40px; text-align:center; color:#ccc;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
            return;
        }

        dayRecords.forEach((r, idx) => {
            let div = document.createElement("div");
            div.className = "record-item";
            
            let amountClass = 'amount-expense';
            let sign = '-';
            let catText = r.category;
            let subText = "ì§€ì¶œ";

            if(r.type === 'income') { amountClass='amount-income'; sign='+'; subText="ìˆ˜ì…"; catText="ìˆ˜ì…"; }
            else if(r.type === 'saving') { amountClass='amount-saving'; sign='-'; subText="ì €ì¶•"; catText="ì €ì¶•"; }
            
            div.innerHTML = `
                <div>
                    <div class="record-cat">${catText}</div>
                    <div class="record-sub">${subText}</div>
                </div>
                <div class="${amountClass}">${sign}${formatMoney(r.amount)}ì›</div>
            `;
            
            // Long Press
            let pressTimer;
            div.addEventListener('touchstart', (e) => {
                pressTimer = setTimeout(() => {
                    if(navigator.vibrate) navigator.vibrate(50);
                    openActionSheet(key, idx, r);
                }, 600);
            });
            div.addEventListener('touchend', () => clearTimeout(pressTimer));
            div.addEventListener('touchmove', () => clearTimeout(pressTimer));
            div.addEventListener('mousedown', () => pressTimer = setTimeout(()=>openActionSheet(key,idx,r), 600));
            div.addEventListener('mouseup', () => clearTimeout(pressTimer));
            
            list.appendChild(div);
        });
    }
</script>
</body>
</html>
