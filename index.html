<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì•„ì´í° ê°€ê³„ë¶€ Pro</title>
<style>
    :root {
        --ios-bg: #F2F2F7;
        --ios-card: #FFFFFF;
        --ios-blue: #007AFF;
        --ios-red: #FF3B30;
        --ios-green: #34C759;
        --ios-yellow: #FFCC00;
        --ios-gray-text: #8E8E93;
        --ios-border: #E5E5EA;
        --ios-black: #000000;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--ios-bg);
        margin: 0;
        padding: 0;
        color: var(--ios-black);
        -webkit-font-smoothing: antialiased;
        user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ (ì•± ëŠë‚Œ) */
    }

    /* ìƒë‹¨ ì”ì•¡ ì¹´ë“œ */
    .header-card {
        background: var(--ios-card);
        padding: 20px 20px 30px 20px;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        text-align: center;
        margin-bottom: 20px;
    }
    
    .header-title { font-size: 14px; color: var(--ios-gray-text); margin-bottom: 5px; }
    .balance-amount { font-size: 34px; font-weight: 700; letter-spacing: -0.5px; }
    
    .action-row {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-main {
        background: var(--ios-blue);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.1s, opacity 0.2s;
        flex: 1;
        max-width: 100px;
    }
    .btn-main:active { transform: scale(0.98); opacity: 0.8; }
    .btn-income { background: var(--ios-green); }
    .btn-budget { background: var(--ios-card); color: var(--ios-blue); border: 1px solid var(--ios-blue); }

    /* ê³µí†µ í¼ ìŠ¤íƒ€ì¼ */
    .modal-overlay {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.4);
        display: none; z-index: 1000;
        align-items: center; justify-content: center;
    }
    .modal-overlay.active { display: flex; }

    .input-group, .budget-modal {
        background: white;
        width: 90%;
        max-width: 400px;
        padding: 24px;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        display: none;
        box-sizing: border-box;
    }
    .input-group.active { display: block; }

    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .form-row { margin-bottom: 16px; }
    .form-label { font-size: 12px; color: var(--ios-gray-text); margin-bottom: 4px; display: block; }
    
    input, select {
        width: 100%; box-sizing: border-box;
        padding: 14px; border-radius: 12px;
        border: 1px solid #E5E5EA; font-size: 16px;
        -webkit-appearance: none; background: #F9F9F9;
        color: var(--ios-black);
    }
    input:focus, select:focus { outline: none; border-color: var(--ios-blue); background: white; }

    .hidden { display: none; }

    /* ë‹¬ë ¥ ì˜ì—­ */
    .calendar-container {
        background: var(--ios-card);
        margin: 0 16px;
        border-radius: 16px;
        padding: 16px;
        box-shadow: 0 1px 5px rgba(0,0,0,0.02);
    }

    .cal-nav {
        display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;
    }
    .cal-title { font-size: 18px; font-weight: 700; }
    .nav-btn { background: none; border: none; font-size: 16px; color: var(--ios-blue); padding: 5px; }

    .weekdays {
        display: grid; grid-template-columns: repeat(7, 1fr);
        text-align: center; font-size: 12px; color: var(--ios-gray-text);
        margin-bottom: 8px; font-weight: 600;
    }

    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }

    .day-cell {
        height: 52px;
        display: flex; flex-direction: column; align-items: center; padding-top: 4px;
        cursor: pointer; border-radius: 8px; position: relative;
    }

    .day-num {
        font-size: 16px; width: 28px; height: 28px;
        display: flex; align-items: center; justify-content: center;
        border-radius: 50%; margin-bottom: 2px;
    }

    .day-cell.today .day-num { background-color: var(--ios-blue); color: white; font-weight: 600; }
    .day-cell.selected { background-color: #F2F2F7; }

    .status-dot { width: 5px; height: 5px; border-radius: 50%; margin-top: 2px; }
    .dot-green { background-color: var(--ios-green); }
    .dot-yellow { background-color: var(--ios-yellow); }
    .dot-red { background-color: var(--ios-red); }

    .sun { color: var(--ios-red); }
    .sat { color: var(--ios-blue); }

    /* ë¦¬ìŠ¤íŠ¸ ì˜ì—­ */
    .detail-section { margin: 24px 16px 40px 16px; }
    .list-header { font-size: 13px; color: var(--ios-gray-text); margin-bottom: 8px; margin-left: 10px; }
    
    .record-list { background: var(--ios-card); border-radius: 12px; overflow: hidden; }
    
    .record-item {
        padding: 16px;
        border-bottom: 1px solid var(--ios-border);
        display: flex; justify-content: space-between; align-items: center;
        transition: background 0.2s;
    }
    .record-item:active { background: #f0f0f0; }
    .record-item:last-child { border-bottom: none; }
    
    .record-info { display: flex; flex-direction: column; gap: 2px; }
    .record-cat { font-size: 16px; font-weight: 500; }
    .record-desc { font-size: 12px; color: #999; }
    .record-amount { font-size: 16px; font-weight: 600; }
    .amount-expense { color: var(--ios-black); }
    .amount-income { color: var(--ios-green); }

    /* íŒì—… ë‹«ê¸° ë²„íŠ¼ */
    .close-btn {
        background: #E5E5EA; color: black; border: none; padding: 12px; 
        border-radius: 12px; font-weight: 600; margin-top: 10px; width: 100%;
    }

    /* ì˜ˆì‚° ì„¤ì • ëª¨ë‹¬ ë‚´ë¶€ */
    .budget-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
    }
</style>
</head>
<body>

<div class="header-card">
    <div class="header-title">í˜„ì¬ ìì‚°</div>
    <div class="balance-amount" id="balanceDisplay">0ì›</div>
    <div class="action-row">
        <button class="btn-main" onclick="openForm('expense')">ì§€ì¶œ ê¸°ë¡</button>
        <button class="btn-main btn-income" onclick="openForm('income')">ìˆ˜ì… ê¸°ë¡</button>
        <button class="btn-main btn-budget" onclick="openBudgetModal()">ì˜ˆì‚° ì„¤ì •</button>
    </div>
</div>

<div class="modal-overlay" id="formOverlay" onclick="closeForm(event)">
    <div class="input-group" id="inputForm">
        <h3 id="formTitle" style="margin:0 0 20px 0; font-size:20px; font-weight:700;">ë‚´ì—­ ì¶”ê°€</h3>
        
        <div class="form-row">
            <label class="form-label">ë‚ ì§œ</label>
            <input type="date" id="inputDate">
        </div>

        <div class="form-row" id="typeRow">
            <label class="form-label">ìœ í˜•</label>
            <select id="inputType" onchange="handleTypeChange()">
                <option value="expense">ì§€ì¶œ</option>
                <option value="saving">ì €ì¶•</option>
                <option value="income">ìˆ˜ì…</option>
            </select>
        </div>

        <div class="form-row" id="categoryRow">
            <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
            <select id="inputCategory" onchange="handleCategoryChange()">
                <option value="ì‹ë¹„">ì‹ë¹„</option>
                <option value="êµí†µ">êµí†µ</option>
                <option value="ì‡¼í•‘">ì‡¼í•‘</option>
                <option value="ì£¼ê±°">ì£¼ê±°/í†µì‹ </option>
                <option value="ì˜ë£Œ">ì˜ë£Œ/ê±´ê°•</option>
                <option value="ë¬¸í™”">ë¬¸í™”/ì—¬ê°€</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€ (ì§ì ‘ì…ë ¥)</option>
            </select>
            <input type="text" id="customCategory" class="hidden" placeholder="ì¹´í…Œê³ ë¦¬ ì´ë¦„ ì…ë ¥" style="margin-top:8px;">
        </div>

        <div class="form-row">
            <label class="form-label">ê¸ˆì•¡</label>
            <input type="number" id="inputAmount" placeholder="0" inputmode="numeric">
        </div>

        <button class="btn-main" style="width:100%; margin-top:10px;" onclick="saveRecord()">ì €ì¥í•˜ê¸°</button>
        <button class="close-btn" onclick="closeFormReal()">ë‹«ê¸°</button>
    </div>
</div>

<div class="modal-overlay" id="budgetOverlay" onclick="closeBudgetModal(event)">
    <div class="budget-modal">
        <h3 style="margin:0 0 20px 0;">ìš”ì¼ë³„ ì˜ˆì‚° ì„¤ì •</h3>
        <p style="font-size:12px; color:#888; margin-bottom:15px;">ê° ìš”ì¼ë³„ í•˜ë£¨ ì˜ˆì‚°ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
        <div class="budget-grid">
            <div><label class="form-label">ì›”ìš”ì¼</label><input type="number" id="bg_1"></div>
            <div><label class="form-label">í™”ìš”ì¼</label><input type="number" id="bg_2"></div>
            <div><label class="form-label">ìˆ˜ìš”ì¼</label><input type="number" id="bg_3"></div>
            <div><label class="form-label">ëª©ìš”ì¼</label><input type="number" id="bg_4"></div>
            <div><label class="form-label">ê¸ˆìš”ì¼</label><input type="number" id="bg_5"></div>
            <div><label class="form-label">í† ìš”ì¼</label><input type="number" id="bg_6"></div>
            <div><label class="form-label" style="color:red">ì¼ìš”ì¼</label><input type="number" id="bg_0"></div>
        </div>
        <button class="btn-main" style="width:100%; margin-top:20px;" onclick="saveBudgets()">ì˜ˆì‚° ì €ì¥</button>
        <button class="close-btn" onclick="closeBudgetModalReal()">ë‹«ê¸°</button>
    </div>
</div>

<div class="calendar-container">
    <div class="cal-nav">
        <button class="nav-btn" onclick="changeMonth(-1)">â—€ ì´ì „</button>
        <div class="cal-title" id="monthTitle">2026ë…„ 10ì›”</div>
        <button class="nav-btn" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
    </div>
    <div class="weekdays">
        <div class="sun">ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div class="sat">í† </div>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
</div>

<div class="detail-section">
    <div class="list-header" id="selectedDateTitle">ì˜¤ëŠ˜ì˜ ë‚´ì—­</div>
    <p style="font-size:11px; color:#aaa; margin-left:10px; margin-top:0;">ğŸ’¡ ë‚´ì—­ì„ ê¸¸ê²Œ ëˆ„ë¥´ë©´ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ìš”.</p>
    <div class="record-list" id="recordList"></div>
</div>

<script>
    // --- ë°ì´í„° ê´€ë¦¬ ---
    let balance = parseInt(localStorage.getItem("balance")) || 0;
    let records = JSON.parse(localStorage.getItem("records")) || {};
    
    // ì˜ˆì‚°: 0(ì¼) ~ 6(í† ) ë°°ì—´ë¡œ ê´€ë¦¬. ê¸°ë³¸ê°’ 3ë§Œì›, ì£¼ë§ 5ë§Œì›
    let defaultBudgets = [50000, 30000, 30000, 30000, 30000, 30000, 50000];
    let budgets = JSON.parse(localStorage.getItem("dailyBudgets")) || defaultBudgets;
    
    let currentDate = new Date();
    let selectedDate = new Date();
    
    // ìˆ˜ì • ëª¨ë“œ ê´€ë¦¬ ë³€ìˆ˜
    let isEditing = false;
    let editKey = null;
    let editIndex = null;

    document.addEventListener("DOMContentLoaded", () => {
        updateBalanceUI();
        renderCalendar();
        showRecordsForDate(new Date());
    });

    // --- ìœ í‹¸ë¦¬í‹° ---
    function formatMoney(num) { return num.toLocaleString(); }
    function getDateKey(dateObj) {
        const offset = dateObj.getTimezoneOffset() * 60000;
        return (new Date(dateObj - offset)).toISOString().slice(0, 10);
    }
    function saveData() {
        localStorage.setItem("balance", balance);
        localStorage.setItem("records", JSON.stringify(records));
        localStorage.setItem("dailyBudgets", JSON.stringify(budgets));
        updateBalanceUI();
        renderCalendar();
    }
    function updateBalanceUI() {
        document.getElementById("balanceDisplay").innerText = formatMoney(balance) + "ì›";
    }

    // --- í¼ UI ì œì–´ ---
    function openForm(mode, record = null) {
        const overlay = document.getElementById("formOverlay");
        const formDiv = document.getElementById("inputForm");
        const typeSelect = document.getElementById("inputType");
        const catRow = document.getElementById("categoryRow");
        const dateInput = document.getElementById("inputDate");

        overlay.classList.add("active");
        formDiv.classList.add("active");

        // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ
        if (record) {
            document.getElementById("formTitle").innerText = "ë‚´ì—­ ìˆ˜ì •";
            dateInput.value = editKey; // YYYY-MM-DD
            document.getElementById("inputAmount").value = record.amount;
            
            // ëª¨ë“  ì˜µì…˜ì„ ë³´ì´ê²Œ ì ì‹œ ì´ˆê¸°í™” í›„ ê°’ ì„¸íŒ…
            typeSelect.innerHTML = `
                <option value="expense">ì§€ì¶œ</option>
                <option value="saving">ì €ì¶•</option>
                <option value="income">ìˆ˜ì…</option>
            `;
            typeSelect.value = record.type;
            
            if(record.type === 'expense') {
                catRow.classList.remove("hidden");
                // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì²´í¬
                const basicCats = ["ì‹ë¹„","êµí†µ","ì‡¼í•‘","ì£¼ê±°","ì˜ë£Œ","ë¬¸í™”"];
                if(basicCats.includes(record.category)){
                    document.getElementById("inputCategory").value = record.category;
                    document.getElementById("customCategory").classList.add("hidden");
                } else {
                    document.getElementById("inputCategory").value = "ê¸°íƒ€";
                    document.getElementById("customCategory").classList.remove("hidden");
                    document.getElementById("customCategory").value = record.category;
                }
            } else {
                catRow.classList.add("hidden");
            }
        } 
        // ì‹ ê·œ ì‘ì„± ëª¨ë“œì¼ ë•Œ
        else {
            isEditing = false;
            document.getElementById("formTitle").innerText = "ë‚´ì—­ ì¶”ê°€";
            dateInput.valueAsDate = selectedDate; // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ ìë™ ì…ë ¥
            document.getElementById("inputAmount").value = "";
            document.getElementById("customCategory").value = "";
            document.getElementById("customCategory").classList.add("hidden");
            document.getElementById("inputCategory").value = "ì‹ë¹„";

            typeSelect.innerHTML = ""; // ì˜µì…˜ ì´ˆê¸°í™”
            if (mode === 'expense') {
                // ì§€ì¶œ ê¸°ë¡: ìˆ˜ì… ì œì™¸
                let opt1 = new Option("ì§€ì¶œ", "expense");
                let opt2 = new Option("ì €ì¶•", "saving");
                typeSelect.add(opt1);
                typeSelect.add(opt2);
                catRow.classList.remove("hidden");
            } else if (mode === 'income') {
                // ìˆ˜ì… ê¸°ë¡: ìˆ˜ì… ê³ ì •
                let opt = new Option("ìˆ˜ì…", "income");
                typeSelect.add(opt);
                catRow.classList.add("hidden");
            }
        }
    }

    function handleTypeChange() {
        const type = document.getElementById("inputType").value;
        const catRow = document.getElementById("categoryRow");
        if(type === 'expense') catRow.classList.remove("hidden");
        else catRow.classList.add("hidden");
    }

    function handleCategoryChange() {
        const cat = document.getElementById("inputCategory").value;
        const customInput = document.getElementById("customCategory");
        if(cat === "ê¸°íƒ€") {
            customInput.classList.remove("hidden");
            customInput.focus();
        } else {
            customInput.classList.add("hidden");
        }
    }

    function closeForm(e) { if(e.target.id === "formOverlay") closeFormReal(); }
    function closeFormReal() {
        document.getElementById("formOverlay").classList.remove("active");
        isEditing = false;
        editKey = null;
        editIndex = null;
    }

    // --- ì˜ˆì‚° ì„¤ì • ëª¨ë‹¬ ---
    function openBudgetModal() {
        const overlay = document.getElementById("budgetOverlay");
        const modal = document.querySelector(".budget-modal");
        overlay.classList.add("active");
        modal.style.display = "block";
        
        // ê°’ ì±„ì›Œë„£ê¸°
        for(let i=0; i<7; i++) {
            document.getElementById(`bg_${i}`).value = budgets[i];
        }
    }
    function closeBudgetModal(e) { if(e.target.id === "budgetOverlay") closeBudgetModalReal(); }
    function closeBudgetModalReal() {
        document.getElementById("budgetOverlay").classList.remove("active");
    }
    function saveBudgets() {
        for(let i=0; i<7; i++) {
            let val = parseInt(document.getElementById(`bg_${i}`).value);
            budgets[i] = isNaN(val) ? 0 : val;
        }
        saveData();
        closeBudgetModalReal();
        alert("ìš”ì¼ë³„ ì˜ˆì‚°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    // --- ì €ì¥ ë° ìˆ˜ì • ë¡œì§ ---
    function saveRecord() {
        const dateVal = document.getElementById("inputDate").value;
        const type = document.getElementById("inputType").value;
        const amount = parseInt(document.getElementById("inputAmount").value);
        let category = "-";

        if (!dateVal || isNaN(amount)) { alert("ë‚ ì§œì™€ ê¸ˆì•¡ì„ í™•ì¸í•´ì£¼ì„¸ìš”."); return; }

        if (type === 'expense') {
            const catSelect = document.getElementById("inputCategory").value;
            if (catSelect === 'ê¸°íƒ€') {
                category = document.getElementById("customCategory").value || "ê¸°íƒ€";
            } else {
                category = catSelect;
            }
        } else if (type === 'saving') {
            category = "ì €ì¶•";
        } else {
            category = "ìˆ˜ì…";
        }

        // 1. ê¸°ì¡´ ë°ì´í„°ê°€ ìˆì—ˆë‹¤ë©´ ë¡¤ë°±(ì‚­ì œ) í›„ ë‹¤ì‹œ ì €ì¥ (ì”ì•¡ ë³´ì •)
        if (isEditing) {
            let oldRecord = records[editKey][editIndex];
            if (oldRecord.type === 'income') balance -= oldRecord.amount;
            else balance += oldRecord.amount;
            
            // ë°°ì—´ì—ì„œ ì‚­ì œ
            records[editKey].splice(editIndex, 1);
            if(records[editKey].length === 0) delete records[editKey];
        }

        // 2. ìƒˆ ë°ì´í„° ì €ì¥
        if (!records[dateVal]) records[dateVal] = [];
        records[dateVal].push({ type, amount, category });

        // ì”ì•¡ ë°˜ì˜
        if (type === 'income') balance += amount;
        else balance -= amount;

        saveData();
        closeFormReal();

        // ë‚ ì§œ ì´ë™ ë° ê°±ì‹ 
        selectedDate = new Date(dateVal);
        changeMonth(0); // ë‹¬ë ¥ ê°±ì‹ ìš© (í˜„ì¬ ë‹¬ ìœ ì§€í•˜ë˜ ì  ì°ê¸° ìœ„í•´)
        showRecordsForDate(selectedDate);
    }

    // --- ë‹¬ë ¥ ë Œë”ë§ ---
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        document.getElementById("monthTitle").innerText = `${year}ë…„ ${month + 1}ì›”`;

        const grid = document.getElementById("calendarGrid");
        grid.innerHTML = "";

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement("div"));

        for (let d = 1; d <= lastDate; d++) {
            let dateObj = new Date(year, month, d);
            let key = getDateKey(dateObj);
            let dayOfWeek = dateObj.getDay();

            let el = document.createElement("div");
            el.className = "day-cell";
            if (key === getDateKey(new Date())) el.classList.add("today");
            if (key === getDateKey(selectedDate)) el.classList.add("selected");

            let num = document.createElement("div");
            num.className = "day-num";
            num.innerText = d;
            if(dayOfWeek===0) num.style.color="var(--ios-red)";
            if(dayOfWeek===6) num.style.color="var(--ios-blue)";
            if(key === getDateKey(new Date()) && (dayOfWeek===0||dayOfWeek===6)) num.style.color="white";

            el.appendChild(num);

            // ì  ì°ê¸° ë¡œì§
            let dailyExpense = 0;
            if (records[key]) {
                records[key].forEach(r => { if (r.type === 'expense') dailyExpense += r.amount; });
            }

            if (dailyExpense > 0) {
                let limit = budgets[dayOfWeek]; // ìš”ì¼ë³„ ì˜ˆì‚° ì ìš©
                let dot = document.createElement("div");
                dot.className = "status-dot";
                if (dailyExpense > limit) dot.classList.add("dot-red");
                else if (dailyExpense === limit) dot.classList.add("dot-yellow");
                else dot.classList.add("dot-green");
                el.appendChild(dot);
            }

            el.onclick = () => {
                selectedDate = new Date(year, month, d);
                renderCalendar();
                showRecordsForDate(selectedDate);
            };
            grid.appendChild(el);
        }
    }

    function changeMonth(n) {
        currentDate.setMonth(currentDate.getMonth() + n);
        renderCalendar();
    }

    // --- ë¦¬ìŠ¤íŠ¸ ë° ìˆ˜ì •(Long Press) ---
    function showRecordsForDate(dateObj) {
        let key = getDateKey(dateObj);
        const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
        document.getElementById("selectedDateTitle").innerText = `${dateObj.getMonth()+1}ì›” ${dateObj.getDate()}ì¼ (${days[dateObj.getDay()]})`;

        let list = document.getElementById("recordList");
        list.innerHTML = "";
        
        let dayRecords = records[key] || [];
        if (dayRecords.length === 0) {
            list.innerHTML = `<div style="padding:30px; text-align:center; color:#ccc;">ë‚´ì—­ ì—†ìŒ</div>`;
            return;
        }

        dayRecords.forEach((r, index) => {
            let div = document.createElement("div");
            div.className = "record-item";
            let sign = r.type === 'income' ? '+' : '-';
            let colorClass = r.type === 'income' ? 'amount-income' : 'amount-expense';
            let catText = r.type === 'income' ? 'ìˆ˜ì…' : (r.category || 'ì§€ì¶œ');
            
            div.innerHTML = `
                <div class="record-info">
                    <span class="record-cat">${catText}</span>
                    <span class="record-desc">${r.type === 'saving' ? 'ì €ì¶•' : (r.type === 'income'?'':'ì§€ì¶œ')}</span>
                </div>
                <div class="record-amount ${colorClass}">${sign}${formatMoney(r.amount)}ì›</div>
            `;

            // Long Press Event for Edit
            let pressTimer;
            div.addEventListener('touchstart', (e) => {
                pressTimer = setTimeout(() => {
                    // ì§„ë™ (ëª¨ë°”ì¼ ì§€ì›ì‹œ)
                    if(navigator.vibrate) navigator.vibrate(50);
                    startEdit(key, index, r);
                }, 800);
            });
            div.addEventListener('touchend', () => clearTimeout(pressTimer));
            div.addEventListener('touchmove', () => clearTimeout(pressTimer)); // ìŠ¤í¬ë¡¤ ì‹œ ì·¨ì†Œ
            
            // PCìš© ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
            div.addEventListener('mousedown', () => {
                pressTimer = setTimeout(() => startEdit(key, index, r), 800);
            });
            div.addEventListener('mouseup', () => clearTimeout(pressTimer));

            list.appendChild(div);
        });
    }

    function startEdit(key, index, record) {
        if(confirm("ì´ ë‚´ì—­ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            isEditing = true;
            editKey = key;
            editIndex = index;
            // ìˆ˜ì • ëª¨ë“œë¡œ í¼ ì—´ê¸°
            openForm(null, record); 
        }
    }

</script>
</body>
</html>
